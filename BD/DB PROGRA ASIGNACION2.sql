﻿/*
Created: 13/02/2023
Modified: 20/02/2023
Model: Veterinaria_SOS
Database: MS SQL Server 2017
*/


-- Create tables section -------------------------------------------------

-- Table VT_PROPIETARIOS
CREATE DATABASE VETERINARIASOS;
GO 
USE VETERINARIASOS;

CREATE TABLE [VT_PROPIETARIOS]
(
 [PRO_ID] Int IDENTITY(1,1) NOT FOR REPLICATION NOT NULL,
 [PRO_IDENTIFICACION] Varchar(15) NOT NULL,
 [PRO_PRIMER_NOMBRE] Varchar(25) NOT NULL,
 [PRO_SEGUNDO_NOMBRE] Varchar(25) NOT NULL,
 [PRO_PRIMER_APELLIDO] Varchar(25) NOT NULL,
 [PRO_SEGUNDO_APELLIDO] Varchar(25) NOT NULL,
 [PRO_TELEFONO] Varchar(8) NOT NULL,
 [PRO_CORREO] Varchar(150) NOT NULL,
 [PRO_ADICIONADO_POR] Varchar(15) NOT NULL,
 [PRO_FECHA_ADICION] Datetime NOT NULL,
 [PRO_MODIFICADO_POR] Varchar(15) NULL,
 [PRO_FECHA_MODIFICACION] Datetime NULL
)
go

-- Add keys for table VT_PROPIETARIOS

ALTER TABLE [VT_PROPIETARIOS] ADD CONSTRAINT [PK_VT_PROPIETARIOS] PRIMARY KEY ([PRO_ID])
go

-- Table VT_MASCOTAS

CREATE TABLE [VT_MASCOTAS]
(
 [MAS_ID] Int IDENTITY(1,1) NOT FOR REPLICATION NOT NULL,
 [MAS_NOMBRE] Varchar(15) NOT NULL,
 [MAS_FECHA_NACIMIENTO] Date NOT NULL,
 [MAS_SEXO] Varchar(1) NOT NULL,
 [MAS_PESO] Numeric(5,2) NOT NULL,
 [MAS_ALERGIAS] Varchar(150) NULL,
 [MAS_PRO_ID] Int NOT NULL,
 [MAS_ADICIONADO_POR] Varchar(15) NOT NULL,
 [MAS_FECHA_ADICION] Datetime NOT NULL,
 [MAS_MODIFICADO_POR] Varchar(15) NULL,
 [MAS_FECHA_MODIFICACION] Datetime NULL
)
go

-- Add keys for table VT_MASCOTAS

ALTER TABLE [VT_MASCOTAS] ADD CONSTRAINT [PK_VT_MASCOTAS] PRIMARY KEY ([MAS_ID])
go

-- Table VT_HOJA

CREATE TABLE [VT_HOJA]
(
 [HOJ_ID] Int IDENTITY(1,1) NOT FOR REPLICATION NOT NULL,
 [HOJ_FECHA_ATENCION] Date NOT NULL,
 [HOJ_SINTOMAS] Varchar(150) NOT NULL,
 [HOJ_DIAGNOSTICO] Varchar(150) NOT NULL,
 [HOJ_TRATAMIENTO] Varchar(150) NOT NULL,
 [HOJ_MAS_ID] Int NOT NULL,
 [HOJ_ADICIONADO_POR] Varchar(15) NOT NULL,
 [HOJ_FECHA_ADICION] Datetime NOT NULL,
 [HOJ_MODIFICADO_POR] Varchar(15) NULL,
 [HOJ_FECHA_MODIFICACION] Datetime NULL
)
go

-- Add keys for table VT_HOJA

ALTER TABLE [VT_HOJA] ADD CONSTRAINT [PK_VT_HOJA] PRIMARY KEY ([HOJ_ID])
go

-- Table VT_USUARIOS

CREATE TABLE [VT_USUARIOS]
(
 [USU_ID] Int IDENTITY(1,1) NOT FOR REPLICATION NOT NULL,
 [USU_USUARIO] Varchar(15) NOT NULL,
 [USU_CLAVE] Varchar(10) NOT NULL,
 [USU_ESTADO] Varchar(1) NOT NULL,
 [USU_ADICIONADO_POR] Varchar(15) NOT NULL,
 [USU_FECHA_ADICION] Datetime NOT NULL,
 [USU_MODIFICADO_POR] Varchar(15) NULL,
 [USU_FECHA_MODIFICACION] Datetime NULL,
  CONSTRAINT [CK_CR_USUARIOS_ESTADO] CHECK (USU_ESTADO in ('A','I'))
)
go

-- Add keys for table VT_USUARIOS

ALTER TABLE [VT_USUARIOS] ADD CONSTRAINT [PK_VT_USUARIOS] PRIMARY KEY ([USU_ID])
go

-- Create foreign keys (relationships) section ------------------------------------------------- 


ALTER TABLE [VT_MASCOTAS] ADD CONSTRAINT [PRO_X_MAS] FOREIGN KEY ([MAS_PRO_ID]) REFERENCES [VT_PROPIETARIOS] ([PRO_ID]) ON UPDATE NO ACTION ON DELETE NO ACTION
go


ALTER TABLE [VT_HOJA] ADD CONSTRAINT [MAS_X_HOJ] FOREIGN KEY ([HOJ_MAS_ID]) REFERENCES [VT_MASCOTAS] ([MAS_ID]) ON UPDATE NO ACTION ON DELETE NO ACTION
go


INSERT INTO[VT_USUARIOS] (
    [USU_USUARIO],
    [USU_CLAVE],
    [USU_ESTADO],
    [USU_ADICIONADO_POR],
    [USU_FECHA_ADICION],
    [USU_MODIFICADO_POR],
    [USU_FECHA_MODIFICACION]
)
VALUES (
    'admin',                   -- USU_USUARIO
    'clave123',                -- USU_CLAVE (idealmente encriptada)
    'A',                       -- USU_ESTADO ('A' = Activo, por ejemplo)
    'sistema',                -- USU_ADICIONADO_POR
    GETDATE(),                 -- USU_FECHA_ADICION
    NULL,                      -- USU_MODIFICADO_POR
    NULL                       -- USU_FECHA_MODIFICACION
);


SELECT USU_USUARIO, USU_CLAVE, LEN(USU_CLAVE) FROM VT_USUARIOS

INSERT INTO VT_PROPIETARIOS (
    PRO_IDENTIFICACION, PRO_PRIMER_NOMBRE, PRO_SEGUNDO_NOMBRE,
    PRO_PRIMER_APELLIDO, PRO_SEGUNDO_APELLIDO, PRO_TELEFONO,
    PRO_CORREO, PRO_ADICIONADO_POR, PRO_FECHA_ADICION
)
VALUES (
    '123456789', 'Carlos', 'Eduardo',
    'Mora', 'Jiménez', '88889999',
    'carlos@example.com', 'admin', GETDATE()
);


INSERT INTO VT_MASCOTAS (
    MAS_NOMBRE, MAS_FECHA_NACIMIENTO, MAS_SEXO, MAS_PESO,
    MAS_ALERGIAS, MAS_PRO_ID, MAS_ADICIONADO_POR, MAS_FECHA_ADICION
)
VALUES (
    'Luna', '2022-08-15', 'F', 12.5,
    'Ninguna', 1, 'admin', GETDATE()
);

SELECT * FROM VT_MASCOTAS

SELECT * FROM VT_HOJA;
